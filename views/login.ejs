<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>speed</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§‹</text></svg>">
  <link rel="stylesheet" href="css/login.css">
</head>

<body>
  <header>
    <nav class="navbar">
      <ul class="nav-links" id="navLinks">
        <li><a href="/homepage">é¦–é </a></li>
        <li><a href="/menu">èœå–®</a></li>
        <li><a href="/order">ç·šä¸Šè¨‚è³¼</a></li>
        <li><a href="/storepage">é–€å¸‚æ“šé»</a></li>
        <li><a href="/brandStory">å“ç‰Œæ•…äº‹</a></li>
        <li><a href="/frequentlyaskedquestions">å¸¸è¦‹å•é¡Œ</a></li>
      </ul>

      <div class="hamburger" id="hamburger" aria-label="menu" role="button" tabindex="0">
        <span></span><span></span><span></span>
      </div>
    </nav>
  </header>

  <main class="page">
    <div class="wrap">

      <!-- âœ… ä¸€å®šè¦ activeï¼Œå¦å‰‡ CSS æœƒ display:none -->
      <div class="card active" id="login-box">
        <div class="header-card">
          <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
              <h2>æœƒå“¡ç™»å…¥</h2>
              <p class="sub">ç™»å…¥å¾Œå³å¯ä½¿ç”¨ç·šä¸Šè¨‚è³¼åŠŸèƒ½</p>
            </div>
          </div>
        </div>

        <div class="content">
          <form id="login">
            <div class="field">
              <label>å¸³è™Ÿ</label>
              <input class="input" name="username" autocomplete="username" required />
            </div>

            <div class="field">
              <label>å¯†ç¢¼</label>
              <input class="input" name="password" type="password" autocomplete="current-password" required />
            </div>

            <button class="btn" id="loginBtn" type="submit">ç™»å…¥</button>
            <div id="toast" class="toast" role="alert"></div>
          </form>

          <p class="hint">é‚„æ²’æœ‰å¸³è™Ÿï¼Ÿ <a href="/register">å‰å¾€è¨»å†Š</a></p>
        </div>
      </div>

    </div>
  </main>

  <script>
    // ===== æ¼¢å ¡é¸å–® =====
    const hamburger = document.getElementById("hamburger");
    const navLinks = document.getElementById("navLinks");
    if (hamburger && navLinks) {
      hamburger.addEventListener("click", () => {
        navLinks.classList.toggle("active");
      });
    }

    // ===== login =====
    const form = document.getElementById("login");
    const btn = document.getElementById("loginBtn");
    const toast = document.getElementById("toast");

    function showToast(msg, type){
      toast.textContent = msg || "";
      toast.className = "toast show " + (type || "");
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      btn.disabled = true;
      const oldText = btn.textContent;
      btn.textContent = "ç™»å…¥ä¸­...";

      const payload = Object.fromEntries(new FormData(e.target).entries());

      try {
        const r = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        // âœ… ç„¡è«–æˆåŠŸå¤±æ•—ï¼Œéƒ½æŠŠå›å‚³å…§å®¹é¡¯ç¤ºå‡ºä¾†ï¼ˆæ–¹ä¾¿ä½ æŠ“çœŸæ­£åŸå› ï¼‰
        let j = null;
        try { j = await r.json(); } catch (_) {}

        console.log("LOGIN status:", r.status, "response:", j);

        if (r.ok) {
          showToast((j && j.message) ? j.message : "ç™»å…¥æˆåŠŸï¼å³å°‡å›åˆ°é¦–é â€¦", "ok");
          setTimeout(() => location.href = "/homepage", 600);
        } else {
          // âœ… æŠŠå¾Œç«¯ error å®Œæ•´å°å‡ºä¾†
          const msg =
            (j && (j.error || j.message)) ||
            ("ç™»å…¥å¤±æ•—ï¼ˆHTTP " + r.status + "ï¼‰");

          showToast(msg, "bad");
        }
      } catch (err) {
        console.error("LOGIN fetch error:", err);
        showToast("é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦", "bad");
      } finally {
        btn.disabled = false;
        btn.textContent = oldText;
      }
    });
  </script>
</body>
</html>
